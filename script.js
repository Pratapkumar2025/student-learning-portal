/*
 * рд╣рдорд╛рд░ рдкрдврд╝рд╛рдИ - Bihar Student Learning Portal
 * JavaScript for Quiz System, Leaderboard, Progress Tracking
 */

const high_score_messages = [
    "рдЬрд┐рдпрд╛ рд╣реЛ рдмрд┐рд╣рд╛рд░ рдХреЗ рд▓рд╛рд▓рд╛!",
    "рдЖрдЬ рддрд╜ рдзреБрдЖрдБ рдЙрдбрд╝рд╛ рджреЗрд▓рд╜!",
    "рдорд┐рдард╛рдИ рдХрдм рдЦрд┐рдпрд╛рд╡рдд рдмрд╛рдбрд╝рд╜?"
];

const low_score_messages = [
    "рддрдиреА рдФрд░ рдЬреЛрд░ рд▓рдЧрд╛!",
    "рдХрд╛ рд╣реЛ, рдиреАрдВрдж рдореЗрдВ рдмрд╛рдбрд╝рд╜ рдХрд╛?"
];

// ===== Global State =====
// NOTE: quizState is now defined in quiz-system-new.js (subject-wise system)
// Old class-wise quizState commented out to avoid conflicts
/*
let quizState = {
    selectedClass: null,
    selectedSubject: null,
    questionCount: 10, // User selected count
    currentQuestionIndex: 0,
    questions: [],
    answers: [],
    startTime: null,
    timerInterval: null,
    score: {
        correct: 0,
        wrong: 0,
        skipped: 0
    },
    attemptedQuestions: [] // Track question IDs to avoid repetition
};
*/

// ===== Indian Mahapurush Quotes Database =====
const mahapurushQuotes = [
    // Kabir Das
    {
        hindi: "рдмреЛрд▓реА рдПрдХ рдЕрдирдореЛрд▓ рд╣реИ, рдЬреЛ рдХреЛрдИ рдмреЛрд▓реИ рдЬрд╛рдирд┐ред рд╣рд┐рдпреЗ рддрд░рд╛рдЬреВ рддреМрд▓рд┐ рдХреЗ, рддрдм рдореБрдЦ рдмрд╛рд╣рд░ рдЖрдирд┐ред",
        english: "Speech is priceless, if you know how to speak. Weigh it in the scales of your heart before it comes out of your mouth.",
        author: "рд╕рдВрдд рдХрдмреАрд░ рджрд╛рд╕",
        authorEnglish: "Kabir Das",
        icon: "ЁЯУ┐"
    },
    {
        hindi: "рдорд╛рдЯреА рдХрд╣реЗ рдХреБрдореНрд╣рд╛рд░ рд╕реЗ, рддреБ рдХреНрдпрд╛ рд░реМрдВрджреЗ рдореЛрдпред рдПрдХ рджрд┐рди рдРрд╕рд╛ рдЖрдПрдЧрд╛, рдореИрдВ рд░реМрдВрджреВрдЧреА рддреЛрдпред",
        english: "The clay says to the potter: Why do you tread on me? One day will come when I will tread on you.",
        author: "рд╕рдВрдд рдХрдмреАрд░ рджрд╛рд╕",
        authorEnglish: "Kabir Das",
        icon: "ЁЯУ┐"
    },
    {
        hindi: "рдХрд╛рд▓ рдХрд░реЗ рд╕реЛ рдЖрдЬ рдХрд░, рдЖрдЬ рдХрд░реЗ рд╕реЛ рдЕрдмред рдкрд▓ рдореЗрдВ рдкрд░рд▓рдп рд╣реЛрдПрдЧреА, рдмрд╣реБрд░рд┐ рдХрд░реЗрдЧрд╛ рдХрдмред",
        english: "What you do tomorrow, do today; what you do today, do now. Destruction will come in a moment; when will you do it again?",
        author: "рд╕рдВрдд рдХрдмреАрд░ рджрд╛рд╕",
        authorEnglish: "Kabir Das",
        icon: "ЁЯУ┐"
    },

    // Mahatma Gandhi
    {
        hindi: "рдЦреБрдж рд╡реЛ рдмрджрд▓рд╛рд╡ рдмрдирд┐рдП рдЬреЛ рдЖрдк рджреБрдирд┐рдпрд╛ рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред",
        english: "Be the change that you wish to see in the world.",
        author: "рдорд╣рд╛рддреНрдорд╛ рдЧрд╛рдВрдзреА",
        authorEnglish: "Mahatma Gandhi",
        icon: "ЁЯХКя╕П"
    },
    {
        hindi: "рдХрдордЬреЛрд░ рдХрднреА рдорд╛рдлрд╝ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред рдХреНрд╖рдорд╛ рдХрд░рдирд╛ рддреЛ рддрд╛рдХрддрд╡рд░ рдХреА рдирд┐рд╢рд╛рдиреА рд╣реИред",
        english: "The weak can never forgive. Forgiveness is the attribute of the strong.",
        author: "рдорд╣рд╛рддреНрдорд╛ рдЧрд╛рдВрдзреА",
        authorEnglish: "Mahatma Gandhi",
        icon: "ЁЯХКя╕П"
    },
    {
        hindi: "рдереЛрдбрд╝рд╛ рд╕рд╛ рдЕрднреНрдпрд╛рд╕ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЙрдкрджреЗрд╢реЛрдВ рд╕реЗ рдмреЗрд╣рддрд░ рд╣реИред",
        english: "An ounce of practice is worth more than tons of preaching.",
        author: "рдорд╣рд╛рддреНрдорд╛ рдЧрд╛рдВрдзреА",
        authorEnglish: "Mahatma Gandhi",
        icon: "ЁЯХКя╕П"
    },
    {
        hindi: "рд╢рдХреНрддрд┐ рд╢рд╛рд░реАрд░рд┐рдХ рдХреНрд╖рдорддрд╛ рд╕реЗ рдирд╣реАрдВ рдЖрддреА, рдпрд╣ рдЕрджрдореНрдп рдЗрдЪреНрдЫрд╛ рд╢рдХреНрддрд┐ рд╕реЗ рдЖрддреА рд╣реИред",
        english: "Strength does not come from physical capacity. It comes from an indomitable will.",
        author: "рдорд╣рд╛рддреНрдорд╛ рдЧрд╛рдВрдзреА",
        authorEnglish: "Mahatma Gandhi",
        icon: "ЁЯХКя╕П"
    },

    // Dr. Bhimrao Ambedkar
    {
        hindi: "рд╢рд┐рдХреНрд╖рд┐рдд рдмрдиреЛ, рд╕рдВрдЧрдард┐рдд рд░рд╣реЛ, рд╕рдВрдШрд░реНрд╖ рдХрд░реЛред",
        english: "Educate, Agitate, Organize.",
        author: "рдбреЙ. рднреАрдорд░рд╛рд╡ рдЕрдореНрдмреЗрдбрдХрд░",
        authorEnglish: "Dr. B.R. Ambedkar",
        icon: "ЁЯУЪ"
    },
    {
        hindi: "рдЬреАрд╡рди рд▓рдВрдмрд╛ рд╣реЛрдиреЗ рдХреА рдмрдЬрд╛рдп рдорд╣рд╛рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред",
        english: "Life should be great rather than long.",
        author: "рдбреЙ. рднреАрдорд░рд╛рд╡ рдЕрдореНрдмреЗрдбрдХрд░",
        authorEnglish: "Dr. B.R. Ambedkar",
        icon: "ЁЯУЪ"
    },
    {
        hindi: "рдореИрдВ рдРрд╕реЗ рдзрд░реНрдо рдХреЛ рдорд╛рдирддрд╛ рд╣реВрдБ рдЬреЛ рд╕реНрд╡рддрдВрддреНрд░рддрд╛, рд╕рдорд╛рдирддрд╛ рдФрд░ рднрд╛рдИрдЪрд╛рд░рд╛ рд╕рд┐рдЦрд╛рддрд╛ рд╣реИред",
        english: "I measure the progress of a community by the degree of progress which women have achieved.",
        author: "рдбреЙ. рднреАрдорд░рд╛рд╡ рдЕрдореНрдмреЗрдбрдХрд░",
        authorEnglish: "Dr. B.R. Ambedkar",
        icon: "ЁЯУЪ"
    },
    {
        hindi: "рдЬреНрдЮрд╛рди рд╢рдХреНрддрд┐ рд╣реИ рдФрд░ рд╣рд░ рд╡реНрдпрдХреНрддрд┐ рдХреЛ рд╢рд┐рдХреНрд╖рд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред",
        english: "Knowledge is power and every person should be educated.",
        author: "рдбреЙ. рднреАрдорд░рд╛рд╡ рдЕрдореНрдмреЗрдбрдХрд░",
        authorEnglish: "Dr. B.R. Ambedkar",
        icon: "ЁЯУЪ"
    },

    // Swami Vivekananda
    {
        hindi: "рдЙрдареЛ, рдЬрд╛рдЧреЛ рдФрд░ рддрдм рддрдХ рдирд╣реАрдВ рд░реБрдХреЛ рдЬрдм рддрдХ рд▓рдХреНрд╖реНрдп рдкреНрд░рд╛рдкреНрдд рди рд╣реЛ рдЬрд╛рдпреЗред",
        english: "Arise, awake, and stop not till the goal is reached.",
        author: "рд╕реНрд╡рд╛рдореА рд╡рд┐рд╡реЗрдХрд╛рдирдВрдж",
        authorEnglish: "Swami Vivekananda",
        icon: "ЁЯзШ"
    },
    {
        hindi: "рд╢рдХреНрддрд┐ рдЬреАрд╡рди рд╣реИ, рдирд┐рд░реНрдмрд▓рддрд╛ рдореГрддреНрдпреБ рд╣реИред рд╡рд┐рд╕реНрддрд╛рд░ рдЬреАрд╡рди рд╣реИ, рд╕рдВрдХреБрдЪрди рдореГрддреНрдпреБ рд╣реИред",
        english: "Strength is life, weakness is death. Expansion is life, contraction is death.",
        author: "рд╕реНрд╡рд╛рдореА рд╡рд┐рд╡реЗрдХрд╛рдирдВрдж",
        authorEnglish: "Swami Vivekananda",
        icon: "ЁЯзШ"
    },
    {
        hindi: "рддреБрдореНрд╣реЗрдВ рдХреЛрдИ рдкрдврд╝рд╛ рдирд╣реАрдВ рд╕рдХрддрд╛, рдХреЛрдИ рдЖрдзреНрдпрд╛рддреНрдорд┐рдХ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддрд╛ред рддреБрдордХреЛ рд╕рдм рдХреБрдЫ рдЦреБрдж рдЕрдВрджрд░ рд╕реЗ рд╕реАрдЦрдирд╛ рд╣реИред",
        english: "No one can teach you, no one can make you spiritual. You yourself have to learn everything from within.",
        author: "рд╕реНрд╡рд╛рдореА рд╡рд┐рд╡реЗрдХрд╛рдирдВрдж",
        authorEnglish: "Swami Vivekananda",
        icon: "ЁЯзШ"
    },
    {
        hindi: "рдЬрдм рддрдХ рдЖрдк рдЦреБрдж рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдирд╣реАрдВ рдХрд░рддреЗ, рдЖрдк рднрдЧрд╡рд╛рди рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред",
        english: "You cannot believe in God until you believe in yourself.",
        author: "рд╕реНрд╡рд╛рдореА рд╡рд┐рд╡реЗрдХрд╛рдирдВрдж",
        authorEnglish: "Swami Vivekananda",
        icon: "ЁЯзШ"
    },
    {
        hindi: "рд╢рд┐рдХреНрд╖рд╛ рдордиреБрд╖реНрдп рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рдкреВрд░реНрдгрддрд╛ рдХреА рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╣реИред",
        english: "Education is the manifestation of perfection already in man.",
        author: "рд╕реНрд╡рд╛рдореА рд╡рд┐рд╡реЗрдХрд╛рдирдВрдж",
        authorEnglish: "Swami Vivekananda",
        icon: "ЁЯзШ"
    }
];

// ===== News Headlines (Fallback - Will be fetched from API) =====
let newsHeadlines = [
    "рдмрд┐рд╣рд╛рд░ рдХреЗ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдлреНрдд рдСрдирд▓рд╛рдЗрди рд╢рд┐рдХреНрд╖рд╛",
    "NCERT рд╡рд┐рдЬреНрдЮрд╛рди рдкреНрд░рд╢реНрди рдмреИрдВрдХ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛",
    "рд▓реАрдбрд░рдмреЛрд░реНрдб рдкрд░ рдЕрдкрдирд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ",
    "рдирдпреЗ рдЕрдзреНрдпрд╛рдпреЛрдВ рдХреЗ рдХреНрд╡рд┐рдЬрд╝ рдЬрд▓реНрдж рдЖ рд░рд╣реЗ рд╣реИрдВ"
];

// ===== NCERT Quiz Questions Database (In Hindi) =====
const quizDatabase = {
    5: {
        physics: [
            {
                question: "рдкреНрд░рдХрд╛рд╢ рд╕реАрдзреА рд░реЗрдЦрд╛ рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред рдЗрд╕ рдШрдЯрдирд╛ рдХреЛ рдХреНрдпрд╛ рдХрд╣рддреЗ рд╣реИрдВ?",
                options: ["рдкреНрд░рдХрд╛рд╢ рдХрд╛ рдкрд░рд╛рд╡рд░реНрддрди", "рдкреНрд░рдХрд╛рд╢ рдХрд╛ рдЕрдкрд╡рд░реНрддрди", "рдкреНрд░рдХрд╛рд╢ рдХрд╛ рд╕рд░рд▓ рд░реЗрдЦреАрдп рд╕рдВрдЪрд░рдг", "рдкреНрд░рдХрд╛рд╢ рдХрд╛ рдкреНрд░рдХреАрд░реНрдгрди"],
                correct: 2,
                explanation: "рдкреНрд░рдХрд╛рд╢ рд╣рдореЗрд╢рд╛ рд╕реАрдзреА рд░реЗрдЦрд╛ рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ, рдЬрдм рддрдХ рдХрд┐ рдХреЛрдИ рдмрд╛рдзрд╛ рди рдЖрдПред рдЗрд╕реЗ рдкреНрд░рдХрд╛рд╢ рдХрд╛ рд╕рд░рд▓ рд░реЗрдЦреАрдп рд╕рдВрдЪрд░рдг рдХрд╣рддреЗ рд╣реИрдВред"
            },
            {
                question: "рджрд░реНрдкрдг рд╕реЗ рдмрдирдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░рддрд┐рдмрд┐рдореНрдм рдХреИрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ?",
                options: ["рд╡рд╛рд╕реНрддрд╡рд┐рдХ", "рдХрд╛рд▓реНрдкрдирд┐рдХ", "рдЙрд▓реНрдЯрд╛", "рд╕реАрдзрд╛ рдФрд░ рдХрд╛рд▓реНрдкрдирд┐рдХ"],
                correct: 3,
                explanation: "рд╕рдорддрд▓ рджрд░реНрдкрдг рдореЗрдВ рдмрдирдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░рддрд┐рдмрд┐рдореНрдм рд╕реАрдзрд╛ рдФрд░ рдХрд╛рд▓реНрдкрдирд┐рдХ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рджрд░реНрдкрдг рдХреЗ рдкреАрдЫреЗ рдЙрддрдиреА рд╣реА рджреВрд░реА рдкрд░ рдмрдирддрд╛ рд╣реИ рдЬрд┐рддрдиреА рджреВрд░реА рдкрд░ рд╡рд╕реНрддреБ рд╕рд╛рдордиреЗ рд╣реИред"
            },
            {
                question: "рдзреНрд╡рдирд┐ рдХрд┐рд╕ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдмрд╕реЗ рддреЗрдЬ рдЪрд▓рддреА рд╣реИ?",
                options: ["рд╣рд╡рд╛", "рдкрд╛рдиреА", "рд▓реЛрд╣рд╛", "рд╢реВрдиреНрдп"],
                correct: 2,
                explanation: "рдзреНрд╡рдирд┐ рдареЛрд╕ рдорд╛рдзреНрдпрдо рдореЗрдВ рд╕рдмрд╕реЗ рддреЗрдЬ рдЪрд▓рддреА рд╣реИред рд▓реЛрд╣реЗ рдЬреИрд╕реЗ рдареЛрд╕ рдкрджрд╛рд░реНрдереЛрдВ рдореЗрдВ рдзреНрд╡рдирд┐ рдХреА рдЧрддрд┐ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрддреА рд╣реИред"
            },
            {
                question: "рдЪреБрдВрдмрдХ рдХреЗ рдХрд┐рддрдиреЗ рдзреНрд░реБрд╡ рд╣реЛрддреЗ рд╣реИрдВ?",
                options: ["рдПрдХ", "рджреЛ", "рддреАрди", "рдЪрд╛рд░"],
                correct: 1,
                explanation: "рдкреНрд░рддреНрдпреЗрдХ рдЪреБрдВрдмрдХ рдХреЗ рджреЛ рдзреНрд░реБрд╡ рд╣реЛрддреЗ рд╣реИрдВ - рдЙрддреНрддрд░реА рдзреНрд░реБрд╡ (N) рдФрд░ рджрдХреНрд╖рд┐рдгреА рдзреНрд░реБрд╡ (S)ред рдпреЗ рдзреНрд░реБрд╡ рдЕрд▓рдЧ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗред"
            },
            {
                question: "рд╡рд┐рджреНрдпреБрдд рдзрд╛рд░рд╛ рдХрд┐рд╕ рдпрдВрддреНрд░ рд╕реЗ рдорд╛рдкреА рдЬрд╛рддреА рд╣реИ?",
                options: ["рд╡реЛрд▓реНрдЯрдореАрдЯрд░", "рдПрдореАрдЯрд░", "рдерд░реНрдорд╛рдореАрдЯрд░", "рдмреИрд░реЛрдореАрдЯрд░"],
                correct: 1,
                explanation: "рд╡рд┐рджреНрдпреБрдд рдзрд╛рд░рд╛ рдХреЛ рдПрдореАрдЯрд░ рд╕реЗ рдорд╛рдкрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреА рдЗрдХрд╛рдИ рдПрдореНрдкрд┐рдпрд░ рд╣реИред"
            },
            {
                question: "рд╕реВрд░реНрдп рд╕реЗ рдкреГрдереНрд╡реА рддрдХ рдкреНрд░рдХрд╛рд╢ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд▓рдЧрднрдЧ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИ?",
                options: ["8 рд╕реЗрдХрдВрдб", "8 рдорд┐рдирдЯ", "8 рдШрдВрдЯреЗ", "8 рджрд┐рди"],
                correct: 1,
                explanation: "рд╕реВрд░реНрдп рдХреА рд░реЛрд╢рдиреА рдХреЛ рдкреГрдереНрд╡реА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд▓рдЧрднрдЧ 8 рдорд┐рдирдЯ 20 рд╕реЗрдХрдВрдб рдХрд╛ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИред"
            },
            {
                question: "рдШрд░реНрд╖рдг рдмрд▓ рдХрд╛ рдХреНрдпрд╛ рдкреНрд░рднрд╛рд╡ рд╣реИ?",
                options: ["рдЧрддрд┐ рддреЗрдЬ рдХрд░рддрд╛ рд╣реИ", "рдЧрддрд┐ рдзреАрдореА рдХрд░рддрд╛ рд╣реИ", "рдЧрддрд┐ рдкрд░ рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ", "рджрд┐рд╢рд╛ рдмрджрд▓рддрд╛ рд╣реИ"],
                correct: 1,
                explanation: "рдШрд░реНрд╖рдг рдмрд▓ рд╣рдореЗрд╢рд╛ рдЧрддрд┐ рдХрд╛ рд╡рд┐рд░реЛрдз рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╡рд╕реНрддреБ рдХреА рдЧрддрд┐ рдХреЛ рдзреАрдорд╛ рдХрд░рддрд╛ рд╣реИред"
            },
            {
                question: "рдЗрдВрджреНрд░рдзрдиреБрд╖ рдореЗрдВ рдХрд┐рддрдиреЗ рд░рдВрдЧ рд╣реЛрддреЗ рд╣реИрдВ?",
                options: ["рдкрд╛рдВрдЪ", "рдЫрдГ", "рд╕рд╛рдд", "рдЖрда"],
                correct: 2,
                explanation: "рдЗрдВрджреНрд░рдзрдиреБрд╖ рдореЗрдВ рд╕рд╛рдд рд░рдВрдЧ рд╣реЛрддреЗ рд╣реИрдВ - рд▓рд╛рд▓, рдирд╛рд░рдВрдЧреА, рдкреАрд▓рд╛, рд╣рд░рд╛, рдиреАрд▓рд╛, рдЬрд╛рдореБрдиреА рдФрд░ рдмреИрдВрдЧрдиреА (VIBGYOR)ред"
            },
            {
                question: "рдкрд╛рдиреА рдХрд╛ рдХреНрд╡рдердирд╛рдВрдХ рдХрд┐рддрдирд╛ рд╣реЛрддрд╛ рд╣реИ?",
                options: ["0┬░C", "50┬░C", "100┬░C", "150┬░C"],
                correct: 2,
                explanation: "рд╕рд╛рдорд╛рдиреНрдп рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рджрд╛рдм рдкрд░ рдкрд╛рдиреА рдХрд╛ рдХреНрд╡рдердирд╛рдВрдХ 100┬░C рд╣реЛрддрд╛ рд╣реИред"
            },
            {
                question: "рдЫрд╛рдпрд╛ рдХрдм рд╕рдмрд╕реЗ рдЫреЛрдЯреА рд╣реЛрддреА рд╣реИ?",
                options: ["рд╕реБрдмрд╣", "рджреЛрдкрд╣рд░", "рд╢рд╛рдо", "рд░рд╛рдд"],
                correct: 1,
                explanation: "рджреЛрдкрд╣рд░ рдореЗрдВ рдЬрдм рд╕реВрд░реНрдп рд╕рд┐рд░ рдХреЗ рдареАрдХ рдКрдкрд░ рд╣реЛрддрд╛ рд╣реИ, рддрдм рдЫрд╛рдпрд╛ рд╕рдмрд╕реЗ рдЫреЛрдЯреА рд╣реЛрддреА рд╣реИред"
            }
        ],
        chemistry: [
            {
                question: "рдкрд╛рдиреА рдХрд╛ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рд╕реВрддреНрд░ рдХреНрдпрд╛ рд╣реИ?",
                options: ["HтВВO", "COтВВ", "NaCl", "OтВВ"],
                correct: 0,
                explanation: "рдкрд╛рдиреА рдХрд╛ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рд╕реВрддреНрд░ HтВВO рд╣реИред рдЗрд╕рдореЗрдВ рджреЛ рд╣рд╛рдЗрдбреНрд░реЛрдЬрди рдкрд░рдорд╛рдгреБ рдФрд░ рдПрдХ рдСрдХреНрд╕реАрдЬрди рдкрд░рдорд╛рдгреБ рд╣реЛрддрд╛ рд╣реИред"
            },
            {
                question: "рдирдордХ рдХрд╛ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдирд╛рдо рдХреНрдпрд╛ рд╣реИ?",
                options: ["рд╕реЛрдбрд┐рдпрдо рдХреНрд▓реЛрд░рд╛рдЗрдб", "рдХреИрд▓реНрд╢рд┐рдпрдо рдХрд╛рд░реНрдмреЛрдиреЗрдЯ", "рдореИрдЧреНрдиреАрд╢рд┐рдпрдо рд╕рд▓реНрдлреЗрдЯ", "рдкреЛрдЯреИрд╢рд┐рдпрдо рдирд╛рдЗрдЯреНрд░реЗрдЯ"],
                correct: 0,
                explanation: "рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ рдирдордХ рдХрд╛ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдирд╛рдо рд╕реЛрдбрд┐рдпрдо рдХреНрд▓реЛрд░рд╛рдЗрдб (NaCl) рд╣реИред"
            },
            {
                question: "рд╣рд╡рд╛ рдореЗрдВ рдХреМрди рд╕реА рдЧреИрд╕ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╣реИ?",
                options: ["рдСрдХреНрд╕реАрдЬрди", "рдирд╛рдЗрдЯреНрд░реЛрдЬрди", "рдХрд╛рд░реНрдмрди рдбрд╛рдЗрдСрдХреНрд╕рд╛рдЗрдб", "рд╣рд╛рдЗрдбреНрд░реЛрдЬрди"],
                correct: 1,
                explanation: "рд╣рд╡рд╛ рдореЗрдВ рд▓рдЧрднрдЧ 78% рдирд╛рдЗрдЯреНрд░реЛрдЬрди рд╣реЛрддреА рд╣реИ, рдЬреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╣реИред"
            },
            {
                question: "рд╕рд┐рд░рдХрд╛ рдореЗрдВ рдХреМрди рд╕рд╛ рдЕрдореНрд▓ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?",
                options: ["рд╣рд╛рдЗрдбреНрд░реЛрдХреНрд▓реЛрд░рд┐рдХ рдЕрдореНрд▓", "рд╕рд▓реНрдлреНрдпреВрд░рд┐рдХ рдЕрдореНрд▓", "рдПрд╕рд┐рдЯрд┐рдХ рдЕрдореНрд▓", "рдирд╛рдЗрдЯреНрд░рд┐рдХ рдЕрдореНрд▓"],
                correct: 2,
                explanation: "рд╕рд┐рд░рдХреЗ рдореЗрдВ рдПрд╕рд┐рдЯрд┐рдХ рдЕрдореНрд▓ (Acetic Acid) рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред"
            },
            {
                question: "рдкреМрдзреЗ рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╢реНрд▓реЗрд╖рдг рдореЗрдВ рдХреМрди рд╕реА рдЧреИрд╕ рдЫреЛрдбрд╝рддреЗ рд╣реИрдВ?",
                options: ["рдХрд╛рд░реНрдмрди рдбрд╛рдЗрдСрдХреНрд╕рд╛рдЗрдб", "рдСрдХреНрд╕реАрдЬрди", "рдирд╛рдЗрдЯреНрд░реЛрдЬрди", "рд╣рд╛рдЗрдбреНрд░реЛрдЬрди"],
                correct: 1,
                explanation: "рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╢реНрд▓реЗрд╖рдг рдХреА рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкреМрдзреЗ рдСрдХреНрд╕реАрдЬрди рдЧреИрд╕ рдЫреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдмрди рдбрд╛рдЗрдСрдХреНрд╕рд╛рдЗрдб рд▓реЗрддреЗ рд╣реИрдВред"
            },
            {
                question: "рдХреМрди рд╕рд╛ рдкрджрд╛рд░реНрде рдЪреБрдВрдмрдХреАрдп рдирд╣реАрдВ рд╣реИ?",
                options: ["рд▓реЛрд╣рд╛", "рддрд╛рдВрдмрд╛", "рдирд┐рдХрд▓", "рдХреЛрдмрд╛рд▓реНрдЯ"],
                correct: 1,
                explanation: "рддрд╛рдВрдмрд╛ рдЪреБрдВрдмрдХреАрдп рдкрджрд╛рд░реНрде рдирд╣реАрдВ рд╣реИред рд▓реЛрд╣рд╛, рдирд┐рдХрд▓ рдФрд░ рдХреЛрдмрд╛рд▓реНрдЯ рдЪреБрдВрдмрдХреАрдп рдкрджрд╛рд░реНрде рд╣реИрдВред"
            },
            {
                question: "рдмрд░реНрдл рдХрд╛ рдкрд╛рдиреА рдореЗрдВ рдмрджрд▓рдирд╛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ?",
                options: ["рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди", "рднреМрддрд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди", "рдЬреИрд╡рд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди", "рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдирд╣реАрдВ"],
                correct: 1,
                explanation: "рдмрд░реНрдл рдХрд╛ рдкрд╛рдиреА рдореЗрдВ рдмрджрд▓рдирд╛ рднреМрддрд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЗрд╡рд▓ рдЕрд╡рд╕реНрдерд╛ рдмрджрд▓рддреА рд╣реИ, рд░рд╛рд╕рд╛рдпрдирд┐рдХ рд╕рдВрд░рдЪрдирд╛ рдирд╣реАрдВред"
            },
            {
                question: "рдХрдкреВрд░ рдХреЛ рдЧрд░реНрдо рдХрд░рдиреЗ рдкрд░ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ?",
                options: ["рдкрд┐рдШрд▓рддрд╛ рд╣реИ", "рд╕реАрдзреЗ рд╡рд╛рд╖реНрдк рдмрди рдЬрд╛рддрд╛ рд╣реИ", "рдЬрд▓ рдЬрд╛рддрд╛ рд╣реИ", "рдХреБрдЫ рдирд╣реАрдВ рд╣реЛрддрд╛"],
                correct: 1,
                explanation: "рдХрдкреВрд░ рдХреЛ рдЧрд░реНрдо рдХрд░рдиреЗ рдкрд░ рдпрд╣ рд╕реАрдзреЗ рдареЛрд╕ рд╕реЗ рдЧреИрд╕ рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдКрд░реНрдзреНрд╡рдкрд╛рддрди рдХрд╣рддреЗ рд╣реИрдВред"
            },
            {
                question: "рджреВрдз рдореЗрдВ рдХреМрди рд╕рд╛ рдкреЛрд╖рдХ рддрддреНрд╡ рдкреНрд░рдореБрдЦ рд░реВрдк рд╕реЗ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?",
                options: ["рдХрд╛рд░реНрдмреЛрд╣рд╛рдЗрдбреНрд░реЗрдЯ", "рдкреНрд░реЛрдЯреАрди рдФрд░ рдХреИрд▓реНрд╢рд┐рдпрдо", "рд╡рд╕рд╛", "рд╡рд┐рдЯрд╛рдорд┐рди C"],
                correct: 1,
                explanation: "рджреВрдз рдореЗрдВ рдкреНрд░реЛрдЯреАрди рдФрд░ рдХреИрд▓реНрд╢рд┐рдпрдо рдкреНрд░рдореБрдЦ рд░реВрдк рд╕реЗ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред рдпрд╣ рд╣рдбреНрдбрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд▓рд╛рднрджрд╛рдпрдХ рд╣реИред"
            },
            {
                question: "рдЬрдВрдЧ рд▓рдЧрдирд╛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ?",
                options: ["рднреМрддрд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛", "рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛", "рдЬреИрд╡рд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛", "рдпрд╛рдВрддреНрд░рд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛"],
                correct: 1,
                explanation: "рдЬрдВрдЧ рд▓рдЧрдирд╛ рдПрдХ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд▓реЛрд╣рд╛ рдСрдХреНрд╕реАрдЬрди рдФрд░ рдирдореА рдХреЗ рд╕рд╛рде рдорд┐рд▓рдХрд░ рдЖрдпрд░рди рдСрдХреНрд╕рд╛рдЗрдб рдмрдирд╛рддрд╛ рд╣реИред"
            }
        ],
        biology: [
            {
                question: "рдкреМрдзреЛрдВ рдореЗрдВ рднреЛрдЬрди рдмрдирд╛рдиреЗ рдХреА рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреНрдпрд╛ рдХрд╣рддреЗ рд╣реИрдВ?",
                options: ["рд╢реНрд╡рд╕рди", "рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╢реНрд▓реЗрд╖рдг", "рдЙрддреНрд╕рд░реНрдЬрди", "рдкрд╛рдЪрди"],
                correct: 1,
                explanation: "рдкреМрдзреЗ рд╕реВрд░реНрдп рдХреА рд░реЛрд╢рдиреА, рдкрд╛рдиреА рдФрд░ рдХрд╛рд░реНрдмрди рдбрд╛рдЗрдСрдХреНрд╕рд╛рдЗрдб рд╕реЗ рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╢реНрд▓реЗрд╖рдг рдХреА рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рднреЛрдЬрди рдмрдирд╛рддреЗ рд╣реИрдВред"
            },
            {
                question: "рдордиреБрд╖реНрдп рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рдХрд┐рддрдиреА рд╣рдбреНрдбрд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВ?",
                options: ["106", "156", "206", "256"],
                correct: 2,
                explanation: "рдордиреБрд╖реНрдп рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рдХреБрд▓ 206 рд╣рдбреНрдбрд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВред"
            },
            {
                question: "рдкреМрдзреЛрдВ рдХреА рдкрддреНрддрд┐рдпрд╛рдВ рд╣рд░реА рдХреНрдпреЛрдВ рд╣реЛрддреА рд╣реИрдВ?",
                options: ["рдХреНрд▓реЛрд░реЛрдлрд┐рд▓ рдХреЗ рдХрд╛рд░рдг", "рдЬрд▓ рдХреЗ рдХрд╛рд░рдг", "рдСрдХреНрд╕реАрдЬрди рдХреЗ рдХрд╛рд░рдг", "рдорд┐рдЯреНрдЯреА рдХреЗ рдХрд╛рд░рдг"],
                correct: 0,
                explanation: "рдкрддреНрддрд┐рдпреЛрдВ рдореЗрдВ рдХреНрд▓реЛрд░реЛрдлрд┐рд▓ рдирд╛рдордХ рд╣рд░рд╛ рд╡рд░реНрдгрдХ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рд╡реЗ рд╣рд░реА рджрд┐рдЦрддреА рд╣реИрдВред"
            },
            {
                question: "рдордиреБрд╖реНрдп рдХреЗ рджрд╛рдВрдд рдХрд┐рддрдиреЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣реЛрддреЗ рд╣реИрдВ?",
                options: ["рджреЛ", "рддреАрди", "рдЪрд╛рд░", "рдкрд╛рдВрдЪ"],
                correct: 2,
                explanation: "рдордиреБрд╖реНрдп рдХреЗ рджрд╛рдВрдд рдЪрд╛рд░ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣реЛрддреЗ рд╣реИрдВ - рдХреГрдВрддрдХ, рд░рджрдирдХ, рдЕрдЧреНрд░рдЪрд░реНрд╡рдгрдХ рдФрд░ рдЪрд░реНрд╡рдгрдХред"
            },
            {
                question: "рдордЫрд▓рд┐рдпрд╛рдВ рдХрд┐рд╕рд╕реЗ рд╕рд╛рдВрд╕ рд▓реЗрддреА рд╣реИрдВ?",
                options: ["рдлреЗрдлрдбрд╝реЛрдВ рд╕реЗ", "рдЧрд▓рдлрдбрд╝реЛрдВ рд╕реЗ", "рддреНрд╡рдЪрд╛ рд╕реЗ", "рдкрдВрдЦреЛрдВ рд╕реЗ"],
                correct: 1,
                explanation: "рдордЫрд▓рд┐рдпрд╛рдВ рдЧрд▓рдлрдбрд╝реЛрдВ (Gills) рдХреА рд╕рд╣рд╛рдпрддрд╛ рд╕реЗ рдкрд╛рдиреА рдореЗрдВ рдШреБрд▓реА рд╣реБрдИ рдСрдХреНрд╕реАрдЬрди рд▓реЗрддреА рд╣реИрдВред"
            },
            {
                question: "рдХрд┐рд╕ рд╡рд┐рдЯрд╛рдорд┐рди рдХреА рдХрдореА рд╕реЗ рд░рддреМрдВрдзреА рд╣реЛ рдЬрд╛рддреА рд╣реИ?",
                options: ["рд╡рд┐рдЯрд╛рдорд┐рди A", "рд╡рд┐рдЯрд╛рдорд┐рди B", "рд╡рд┐рдЯрд╛рдорд┐рди C", "рд╡рд┐рдЯрд╛рдорд┐рди D"],
                correct: 0,
                explanation: "рд╡рд┐рдЯрд╛рдорд┐рди A рдХреА рдХрдореА рд╕реЗ рд░рддреМрдВрдзреА (рд░рд╛рдд рдореЗрдВ рди рджрд┐рдЦрдирд╛) рдХреА рдмреАрдорд╛рд░реА рд╣реЛрддреА рд╣реИред"
            },
            {
                question: "рдкреМрдзреЛрдВ рдореЗрдВ рдЬрдбрд╝ рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рдХреНрдпрд╛ рд╣реИ?",
                options: ["рднреЛрдЬрди рдмрдирд╛рдирд╛", "рдЬрд▓ рдФрд░ рдЦрдирд┐рдЬ рдЕрд╡рд╢реЛрд╖рд┐рдд рдХрд░рдирд╛", "рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╢реНрд▓реЗрд╖рдг", "рдлреВрд▓ рдмрдирд╛рдирд╛"],
                correct: 1,
                explanation: "рдЬрдбрд╝ рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рдорд┐рдЯреНрдЯреА рд╕реЗ рдЬрд▓ рдФрд░ рдЦрдирд┐рдЬ рд▓рд╡рдгреЛрдВ рдХреЛ рдЕрд╡рд╢реЛрд╖рд┐рдд рдХрд░рдирд╛ рд╣реИред"
            },
            {
                question: "рдорд╛рдирд╡ рд╢рд░реАрд░ рдХрд╛ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЕрдВрдЧ рдХреМрди рд╕рд╛ рд╣реИ?",
                options: ["рдпрдХреГрдд", "рдорд╕реНрддрд┐рд╖реНрдХ", "рддреНрд╡рдЪрд╛", "рд╣реГрджрдп"],
                correct: 2,
                explanation: "рддреНрд╡рдЪрд╛ рдорд╛рдирд╡ рд╢рд░реАрд░ рдХрд╛ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЕрдВрдЧ рд╣реИ рдЬреЛ рдкреВрд░реЗ рд╢рд░реАрд░ рдХреЛ рдврдХрддреА рд╣реИред"
            },
            {
                question: "рдлреВрд▓реЛрдВ рдореЗрдВ рд░рдВрдЧ рдФрд░ рд╕реБрдЧрдВрдз рдХрд╛ рдХреНрдпрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ?",
                options: ["рд╕реМрдВрджрд░реНрдп рдХреЗ рд▓рд┐рдП", "рдХреАрдЯреЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП", "рд╕реВрд░реНрдп рдХреА рд░реЛрд╢рдиреА рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП", "рдЬрд▓ рд╕рдВрдЪрдп рдХреЗ рд▓рд┐рдП"],
                correct: 1,
                explanation: "рдлреВрд▓реЛрдВ рдореЗрдВ рд░рдВрдЧ рдФрд░ рд╕реБрдЧрдВрдз рдХреАрдЯреЛрдВ рдФрд░ рдкрдХреНрд╖рд┐рдпреЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ рдкрд░рд╛рдЧрдг рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред"
            },
            {
                question: "рдкрдХреНрд╖рд┐рдпреЛрдВ рдХреЗ рд╢рд░реАрд░ рдкрд░ рдкрдВрдЦ рдХреНрдпреЛрдВ рд╣реЛрддреЗ рд╣реИрдВ?",
                options: ["рд╕реМрдВрджрд░реНрдп рдХреЗ рд▓рд┐рдП", "рдЙрдбрд╝рдиреЗ рдФрд░ рд╢рд░реАрд░ рдХреЛ рдЧрд░реНрдо рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП", "рднреЛрдЬрди рдХреЗ рд▓рд┐рдП", "рд░рдВрдЧ рдХреЗ рд▓рд┐рдП"],
                correct: 1,
                explanation: "рдкрдВрдЦ рдкрдХреНрд╖рд┐рдпреЛрдВ рдХреЛ рдЙрдбрд╝рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рд╢рд░реАрд░ рдХреЛ рдЧрд░реНрдо рд░рдЦрддреЗ рд╣реИрдВред"
            }
        ],
        general: [
            {
                question: "рд╕реМрд░рдордВрдбрд▓ рдореЗрдВ рдХреБрд▓ рдХрд┐рддрдиреЗ рдЧреНрд░рд╣ рд╣реИрдВ?",
                options: ["7", "8", "9", "10"],
                correct: 1,
                explanation: "рд╕реМрд░рдордВрдбрд▓ рдореЗрдВ рдХреБрд▓ 8 рдЧреНрд░рд╣ рд╣реИрдВред 2006 рдореЗрдВ рдкреНрд▓реВрдЯреЛ рдХреЛ рдЧреНрд░рд╣ рдХреА рд╢реНрд░реЗрдгреА рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред"
            },
            {
                question: "рдкреГрдереНрд╡реА рдХрд╛ рдХрд┐рддрдирд╛ рднрд╛рдЧ рдЬрд▓ рд╕реЗ рдврдХрд╛ рд╣реИ?",
                options: ["50%", "60%", "71%", "80%"],
                correct: 2,
                explanation: "рдкреГрдереНрд╡реА рдХрд╛ рд▓рдЧрднрдЧ 71% рднрд╛рдЧ рдЬрд▓ рд╕реЗ рдврдХрд╛ рд╣реБрдЖ рд╣реИред"
            },
            {
                question: "рдХрд┐рд╕ рдЧреНрд░рд╣ рдХреЛ рд▓рд╛рд▓ рдЧреНрд░рд╣ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ?",
                options: ["рдмреБрдз", "рд╢реБрдХреНрд░", "рдордВрдЧрд▓", "рдмреГрд╣рд╕реНрдкрддрд┐"],
                correct: 2,
                explanation: "рдордВрдЧрд▓ рдЧреНрд░рд╣ рдХреЛ рд▓рд╛рд▓ рдЧреНрд░рд╣ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреА рд╕рддрд╣ рдкрд░ рдЖрдпрд░рди рдСрдХреНрд╕рд╛рдЗрдб (рдЬрдВрдЧ) рдХреА рдЕрдзрд┐рдХрддрд╛ рд╣реИред"
            },
            {
                question: "рд╡рд░реНрд╖рд╛ рдХрд╛ рдЬрд▓ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЬрд▓ рд╣реИ?",
                options: ["рдЦрд╛рд░рд╛ рдЬрд▓", "рдореАрдард╛ рдЬрд▓", "рдХрдареЛрд░ рдЬрд▓", "рднрд╛рд░реА рдЬрд▓"],
                correct: 1,
                explanation: "рд╡рд░реНрд╖рд╛ рдХрд╛ рдЬрд▓ рдореАрдард╛ рдФрд░ рд╢реБрджреНрдз рдЬрд▓ рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд╛рд╖реНрдкреАрдХрд░рдг рд╕реЗ рдмрдирддрд╛ рд╣реИред"
            },
            {
                question: "рднрд╛рд░рдд рдХреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рдирджреА рдХреМрди рд╕реА рд╣реИ?",
                options: ["рдпрдореБрдирд╛", "рдЧреЛрджрд╛рд╡рд░реА", "рдЧрдВрдЧрд╛", "рдирд░реНрдорджрд╛"],
                correct: 2,
                explanation: "рдЧрдВрдЧрд╛ рдирджреА рднрд╛рд░рдд рдХреА рд░рд╛рд╖реНрдЯреНрд░реАрдп рдирджреА рд╣реИред"
            },
            {
                question: "рдкреМрдзреЗ рдХрд┐рд╕ рд╕рдордп рдСрдХреНрд╕реАрдЬрди рдЫреЛрдбрд╝рддреЗ рд╣реИрдВ?",
                options: ["рд░рд╛рдд рдореЗрдВ", "рджрд┐рди рдореЗрдВ", "рд╣рдореЗрд╢рд╛", "рдХрднреА рдирд╣реАрдВ"],
                correct: 1,
                explanation: "рдкреМрдзреЗ рджрд┐рди рдореЗрдВ рдкреНрд░рдХрд╛рд╢ рд╕рдВрд╢реНрд▓реЗрд╖рдг рдХреЗ рджреМрд░рд╛рди рдСрдХреНрд╕реАрдЬрди рдЫреЛрдбрд╝рддреЗ рд╣реИрдВред"
            },
            {
                question: "рджреВрдз рд╕реЗ рджрд╣реА рдмрдирдирд╛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ?",
                options: ["рднреМрддрд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди", "рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди", "рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдирд╣реАрдВ", "рдЕрд╕реНрдерд╛рдпреА рдкрд░рд┐рд╡рд░реНрддрди"],
                correct: 1,
                explanation: "рджреВрдз рд╕реЗ рджрд╣реА рдмрдирдирд╛ рдПрдХ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ рдЬреЛ рдмреИрдХреНрдЯреАрд░рд┐рдпрд╛ рдХреА рдХреНрд░рд┐рдпрд╛ рд╕реЗ рд╣реЛрддрд╛ рд╣реИред"
            },
            {
                question: "рдкреГрдереНрд╡реА рдЕрдкрдиреА рдзреБрд░реА рдкрд░ рдПрдХ рдЪрдХреНрдХрд░ рдХрд┐рддрдиреЗ рд╕рдордп рдореЗрдВ рд▓рдЧрд╛рддреА рд╣реИ?",
                options: ["12 рдШрдВрдЯреЗ", "24 рдШрдВрдЯреЗ", "30 рджрд┐рди", "365 рджрд┐рди"],
                correct: 1,
                explanation: "рдкреГрдереНрд╡реА рдЕрдкрдиреА рдзреБрд░реА рдкрд░ рдПрдХ рдЪрдХреНрдХрд░ рд▓рдЧрднрдЧ 24 рдШрдВрдЯреЗ рдореЗрдВ рдкреВрд░рд╛ рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рджрд┐рди рдФрд░ рд░рд╛рдд рд╣реЛрддреЗ рд╣реИрдВред"
            },
            {
                question: "рдЪрдВрджреНрд░рдорд╛ рдкреГрдереНрд╡реА рдХрд╛ рдПрдХ рдЪрдХреНрдХрд░ рдХрд┐рддрдиреЗ рджрд┐рди рдореЗрдВ рд▓рдЧрд╛рддрд╛ рд╣реИ?",
                options: ["7 рджрд┐рди", "15 рджрд┐рди", "27-28 рджрд┐рди", "365 рджрд┐рди"],
                correct: 2,
                explanation: "рдЪрдВрджреНрд░рдорд╛ рдкреГрдереНрд╡реА рдХреА рдкрд░рд┐рдХреНрд░рдорд╛ рд▓рдЧрднрдЧ 27-28 рджрд┐рдиреЛрдВ рдореЗрдВ рдкреВрд░реА рдХрд░рддрд╛ рд╣реИред"
            },
            {
                question: "рдорд╛рдирд╡ рд╢рд░реАрд░ рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рддрд╛рдкрдорд╛рди рдХрд┐рддрдирд╛ рд╣реЛрддрд╛ рд╣реИ?",
                options: ["37┬░C", "40┬░C", "35┬░C", "32┬░C"],
                correct: 0,
                explanation: "рдорд╛рдирд╡ рд╢рд░реАрд░ рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рддрд╛рдкрдорд╛рди рд▓рдЧрднрдЧ 37┬░C (98.6┬░F) рд╣реЛрддрд╛ рд╣реИред"
            }
        ]
    },
    // Add more classes (6-10) with similar structure
    6: {
        physics: [
            {
                question: "рдХрд┐рд╕реА рд╡рд╕реНрддреБ рдХреА рдЧрддрд┐ рдХрд┐рд╕рд╕реЗ рдорд╛рдкреА рдЬрд╛рддреА рд╣реИ?",
                options: ["рджреНрд░рд╡реНрдпрдорд╛рди", "рдмрд▓", "рдЪрд╛рд▓", "рдЖрдпрддрди"],
                correct: 2,
                explanation: "рд╡рд╕реНрддреБ рдХреА рдЧрддрд┐ рдХреЛ рдЪрд╛рд▓ рд╕реЗ рдорд╛рдкрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рджреВрд░реА рдФрд░ рд╕рдордп рдХрд╛ рдЕрдиреБрдкрд╛рдд рд╣реИред"
            },
            {
                question: "рд▓реАрд╡рд░ рдореЗрдВ рдЖрд▓рдВрдм, рднрд╛рд░ рдФрд░ рдмрд▓ рдореЗрдВ рд╕реЗ рдХреМрди рд╕рд╛ рд╕реНрдерд┐рд░ рд░рд╣рддрд╛ рд╣реИ?",
                options: ["рдЖрд▓рдВрдм", "рднрд╛рд░", "рдмрд▓", "рдХреЛрдИ рдирд╣реАрдВ"],
                correct: 0,
                explanation: "рд▓реАрд╡рд░ рдореЗрдВ рдЖрд▓рдВрдм (Fulcrum) рд╕реНрдерд┐рд░ рдмрд┐рдВрджреБ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд▓реАрд╡рд░ рдШреВрдорддрд╛ рд╣реИред"
            },
            {
                question: "рд╡рд┐рджреНрдпреБрдд рдХрд╛ рд╕реБрдЪрд╛рд▓рдХ рдХреМрди рд╣реИ?",
                options: ["рд▓рдХрдбрд╝реА", "рдкреНрд▓рд╛рд╕реНрдЯрд┐рдХ", "рддрд╛рдВрдмрд╛", "рд░рдмрд░"],
                correct: 2,
                explanation: "рддрд╛рдВрдмрд╛ рд╡рд┐рджреНрдпреБрдд рдХрд╛ рдЕрдЪреНрдЫрд╛ рд╕реБрдЪрд╛рд▓рдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рддрд╛рд░реЛрдВ рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред"
            },
            {
                question: "рдЙрддреНрддрд▓ рд▓реЗрдВрд╕ рд╕реЗ рдмрдирд╛ рдкреНрд░рддрд┐рдмрд┐рдореНрдм рдХреИрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ?",
                options: ["рд╣рдореЗрд╢рд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ", "рд╣рдореЗрд╢рд╛ рдХрд╛рд▓реНрдкрдирд┐рдХ", "рд╡рд╕реНрддреБ рдХреА рд╕реНрдерд┐рддрд┐ рдкрд░ рдирд┐рд░реНрднрд░", "рдХреЛрдИ рдкреНрд░рддрд┐рдмрд┐рдореНрдм рдирд╣реАрдВ рдмрдирддрд╛"],
                correct: 2,
                explanation: "рдЙрддреНрддрд▓ рд▓реЗрдВрд╕ рд╕реЗ рдмрдирдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░рддрд┐рдмрд┐рдореНрдм рд╡рд╕реНрддреБ рдХреА рд╕реНрдерд┐рддрд┐ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ - рдпрд╣ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдпрд╛ рдХрд╛рд▓реНрдкрдирд┐рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред"
            }
        ],
        chemistry: [
            {
                question: "рдЕрдореНрд▓ рдФрд░ рдХреНрд╖рд╛рд░ рдХреА рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдХреНрдпрд╛ рдмрдирддрд╛ рд╣реИ?",
                options: ["рдЬрд▓", "рдирдордХ рдФрд░ рдЬрд▓", "рдЧреИрд╕", "рдзрд╛рддреБ"],
                correct: 1,
                explanation: "рдЕрдореНрд▓ рдФрд░ рдХреНрд╖рд╛рд░ рдХреА рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдирдордХ рдФрд░ рдЬрд▓ рдмрдирддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрджрд╛рд╕реАрдиреАрдХрд░рдг рдХрд╣рддреЗ рд╣реИрдВред"
            },
            {
                question: "рдЪреВрдиреЗ рдХреЗ рдкрд╛рдиреА рдореЗрдВ рдХрд╛рд░реНрдмрди рдбрд╛рдЗрдСрдХреНрд╕рд╛рдЗрдб рдЧреИрд╕ рдбрд╛рд▓рдиреЗ рдкрд░ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ?",
                options: ["рдиреАрд▓рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ", "рджреВрдзрд┐рдпрд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ", "рд▓рд╛рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ", "рдХреБрдЫ рдирд╣реАрдВ рд╣реЛрддрд╛"],
                correct: 1,
                explanation: "рдЪреВрдиреЗ рдХреЗ рдкрд╛рдиреА рдореЗрдВ COтВВ рдЧреИрд╕ рдбрд╛рд▓рдиреЗ рдкрд░ рд╡рд╣ рдХреИрд▓реНрд╢рд┐рдпрдо рдХрд╛рд░реНрдмреЛрдиреЗрдЯ рдмрдирдиреЗ рд╕реЗ рджреВрдзрд┐рдпрд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред"
            }
        ],
        biology: [
            {
                question: "рдордиреБрд╖реНрдп рдореЗрдВ рдкрд╛рдЪрди рдХреНрд░рд┐рдпрд╛ рдХрд╣рд╛рдВ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ?",
                options: ["рдкреЗрдЯ", "рдореБрдВрд╣", "рдЖрдВрдд", "рдпрдХреГрдд"],
                correct: 1,
                explanation: "рдкрд╛рдЪрди рдХреНрд░рд┐рдпрд╛ рдореБрдВрд╣ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ рдЬрд╣рд╛рдВ рд▓рд╛рд░ рднреЛрдЬрди рдХреЛ рддреЛрдбрд╝рдирд╛ рд╢реБрд░реВ рдХрд░рддреА рд╣реИред"
            },
            {
                question: "рд░рдХреНрдд рдХрд╛ рд▓рд╛рд▓ рд░рдВрдЧ рдХрд┐рд╕рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИ?",
                options: ["рдкреНрд▓рд╛рдЬреНрдорд╛", "рд╣реАрдореЛрдЧреНрд▓реЛрдмрд┐рди", "рд╢реНрд╡реЗрдд рд░рдХреНрдд рдХреЛрд╢рд┐рдХрд╛рдПрдВ", "рдкреНрд▓реЗрдЯрд▓реЗрдЯреНрд╕"],
                correct: 1,
                explanation: "рд░рдХреНрдд рдХрд╛ рд▓рд╛рд▓ рд░рдВрдЧ рд╣реАрдореЛрдЧреНрд▓реЛрдмрд┐рди рдирд╛рдордХ рдкреНрд░реЛрдЯреАрди рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд▓рд╛рд▓ рд░рдХреНрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред"
            }
        ],
        general: [
            {
                question: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрдХреНрд╖реА рдХреМрди рд╕рд╛ рд╣реИ?",
                options: ["рдХреЛрдпрд▓", "рдореЛрд░", "рддреЛрддрд╛", "рдХрдмреВрддрд░"],
                correct: 1,
                explanation: "рдореЛрд░ рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрдХреНрд╖реА рд╣реИред"
            }
        ]
    }
    // Classes 7-10 would follow similar pattern with more advanced questions
};

// Replicate similar question sets for classes 7-10 (abbreviated for brevity)
for (let classNum = 7; classNum <= 10; classNum++) {
    quizDatabase[classNum] = {
        physics: quizDatabase[5].physics.slice(0, 10),
        chemistry: quizDatabase[5].chemistry.slice(0, 10),
        biology: quizDatabase[5].biology.slice(0, 10),
        general: quizDatabase[5].general.slice(0, 10)
    };
}

// ===== Navigation Functions =====
function scrollToQuiz() {
    document.getElementById('quiz').scrollIntoView({ behavior: 'smooth' });
}

// ===== News Ticker Functions =====
async function loadNewsHeadlines() {
    try {
        // Try to fetch from News on Air API (Hindi news)
        // Note: This is a fallback approach as direct API may need CORS handling
        const response = await fetch('https://newsonair.gov.in/wp-json/wp/v2/posts?categories=5&per_page=10');
        const data = await response.json();

        if (data && data.length > 0) {
            newsHeadlines = data.map(item => item.title.rendered.replace(/<[^>]*>?/gm, ''));
        }
    } catch (error) {
        console.log('Using fallback news headlines');
        // Use fallback headlines already defined
    }

    updateNewsTicker();
}

function updateNewsTicker() {
    const tickerContent = document.getElementById('tickerContent');
    if (tickerContent) {
        const tickerHTML = newsHeadlines.map((headline, index) =>
            `<span class="ticker-item" data-index="${index}">${headline}</span>`
        ).join(' ');
        tickerContent.innerHTML = tickerHTML;
    }
}

// Refresh news every 30 minutes
setInterval(loadNewsHeadlines, 30 * 60 * 1000);

// ===== Daily Motivational Quotes =====
function displayDailyQuote() {
    const quote = getRandomQuote();
    document.getElementById('quoteText').textContent = quote.hindi;
    document.getElementById('quoteTextEnglish').textContent = quote.english;
    document.getElementById('quoteAuthor').textContent = `${quote.icon} ${quote.author}`;

    // Save quote display time in localStorage
    localStorage.setItem('lastQuoteTime', Date.now());
    localStorage.setItem('currentQuote', JSON.stringify(quote));
}

function getRandomQuote() {
    const randomIndex = Math.floor(Math.random() * mahapurushQuotes.length);
    return mahapurushQuotes[randomIndex];
}

function refreshQuote() {
    displayDailyQuote();
    // Add little animation
    const quoteCard = document.getElementById('dailyQuote');
    quoteCard.style.transform = 'scale(0.95)';
    setTimeout(() => {
        quoteCard.style.transform = 'scale(1)';
    }, 200);
}

// Check if quote needs refresh (hourly)
function checkQuoteRefresh() {
    const lastTime = localStorage.getItem('lastQuoteTime');
    const oneHour = 60 * 60 * 1000;

    if (!lastTime || Date.now() - parseInt(lastTime) > oneHour) {
        displayDailyQuote();
    } else {
        // Load saved quote
        const savedQuote = localStorage.getItem('currentQuote');
        if (savedQuote) {
            const quote = JSON.parse(savedQuote);
            document.getElementById('quoteText').textContent = quote.hindi;
            document.getElementById('quoteTextEnglish').textContent = quote.english;
            document.getElementById('quoteAuthor').textContent = `${quote.icon} ${quote.author}`;
        } else {
            displayDailyQuote();
        }
    }
}

// Auto-refresh quote every hour
setInterval(displayDailyQuote, 60 * 60 * 1000);

// ===== Feedback System =====
function showFeedbackModal() {
    document.getElementById('feedbackModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // Prevent scrolling
}

function closeFeedbackModal() {
    document.getElementById('feedbackModal').classList.add('hidden');
    document.body.style.overflow = 'auto';

    // Reset form
    document.getElementById('feedbackForm').reset();
    document.getElementById('quizRating').value = '0';
    document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
    document.getElementById('feedbackForm').classList.remove('hidden');
    document.getElementById('feedbackSuccess').classList.add('hidden');
}

function submitFeedback(event) {
    event.preventDefault();

    const feedbackData = {
        email: document.getElementById('feedbackEmail').value,
        rating: document.getElementById('quizRating').value,
        feedback: document.getElementById('feedbackText').value,
        timestamp: new Date().toISOString(),
        quizInfo: {
            class: quizState.selectedClass,
            subject: quizState.selectedSubject,
            score: quizState.score
        }
    };

    // Save feedback to localStorage
    let allFeedback = JSON.parse(localStorage.getItem('userFeedback') || '[]');
    allFeedback.push(feedbackData);
    localStorage.setItem('userFeedback', JSON.stringify(allFeedback));

    // Show success message
    document.getElementById('feedbackForm').classList.add('hidden');
    document.getElementById('feedbackSuccess').classList.remove('hidden');

    // Send email notification (simulated - in production would use a service)
    if (feedbackData.email) {
        simulateEmailNotification(feedbackData.email);
    }

    // Auto close after 3 seconds
    setTimeout(closeFeedbackModal, 3000);
}

function simulateEmailNotification(email) {
    console.log(`Feedback confirmation would be sent to: ${email}`);
    // In production, integrate with EmailJS or similar service
}

// Initialize star rating
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('star')) {
        const rating = e.target.dataset.rating;
        document.getElementById('quizRating').value = rating;

        // Update star display
        document.querySelectorAll('.star').forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }
});

// ===== Smart Question Rotation =====
function getAttemptedQuestions() {
    return JSON.parse(localStorage.getItem('attemptedQuestions') || '{}');
}

function saveAttemptedQuestion(classNum, subject, questionIndex) {
    const attempted = getAttemptedQuestions();
    const key = `${classNum}_${subject}`;

    if (!attempted[key]) {
        attempted[key] = [];
    }

    if (!attempted[key].includes(questionIndex)) {
        attempted[key].push(questionIndex);
    }

    localStorage.setItem('attemptedQuestions', JSON.stringify(attempted));
}

function getUnAttemptedQuestions(classNum, subject, allQuestions) {
    const attempted = getAttemptedQuestions();
    const key = `${classNum}_${subject}`;
    const attemptedIndices = attempted[key] || [];

    // If all questions attempted, reset for this subject
    if (attemptedIndices.length >= allQuestions.length) {
        attempted[key] = [];
        localStorage.setItem('attemptedQuestions', JSON.stringify(attempted));
        return allQuestions.map((q, i) => i);
    }

    // Return indices of unattempted questions
    return allQuestions
        .map((q, i) => i)
        .filter(i => !attemptedIndices.includes(i));
}

function selectSmartQuestions(classNum, subject, allQuestions, count = 10) {
    const unattemptedIndices = getUnAttemptedQuestions(classNum, subject, allQuestions);

    // Shuffle unattempted questions
    const shuffled = shuffleArray(unattemptedIndices);

    // Select questions
    const selectedIndices = shuffled.slice(0, Math.min(count, shuffled.length));
    const selectedQuestions = selectedIndices.map(i => ({ ...allQuestions[i], originalIndex: i }));

    return selectedQuestions;
}

// Reset question rotation weekly (every Monday)
function checkWeeklyReset() {
    const lastReset = localStorage.getItem('lastQuestionReset');
    const now = new Date();
    const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, etc.

    if (!lastReset) {
        localStorage.setItem('lastQuestionReset', now.toISOString());
        return;
    }

    const lastResetDate = new Date(lastReset);
    const daysSinceReset = Math.floor((now - lastResetDate) / (1000 * 60 * 60 * 24));

    // Reset on Monday if more than 7 days have passed
    if (dayOfWeek === 1 && daysSinceReset >= 7) {
        localStorage.removeItem('attemptedQuestions');
        localStorage.setItem('lastQuestionReset', now.toISOString());
        console.log('Weekly question rotation reset completed');
    }
}

// ===== ENHANCED MOBILE NAVIGATION =====
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');

    if (navToggle && navMenu) {
        // Toggle menu on hamburger click
        navToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            navMenu.classList.toggle('active');

            // Animate hamburger icon
            const spans = navToggle.querySelectorAll('span');
            if (spans.length === 3) {
                if (navMenu.classList.contains('active')) {
                    spans[0].style.transform = 'rotate(45deg) translateY(10px)';
                    spans[1].style.opacity = '0';
                    spans[2].style.transform = 'rotate(-45deg) translateY(-10px)';
                    // Prevent body scroll when menu open
                    document.body.style.overflow = 'hidden';
                } else {
                    spans[0].style.transform = 'rotate(0)';
                    spans[1].style.opacity = '1';
                    spans[2].style.transform = 'rotate(0)';
                    // Restore body scroll
                    document.body.style.overflow = 'auto';
                }
            }
        });

        // Close menu when clicking nav links
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                navMenu.classList.remove('active');
                // Reset hamburger icon
                const spans = navToggle.querySelectorAll('span');
                if (spans.length === 3) {
                    spans[0].style.transform = 'rotate(0)';
                    spans[1].style.opacity = '1';
                    spans[2].style.transform = 'rotate(0)';
                }
                // Restore body scroll
                document.body.style.overflow = 'auto';

                // Update active state
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                if (navMenu.classList.contains('active')) {
                    navMenu.classList.remove('active');
                    // Reset hamburger icon
                    const spans = navToggle.querySelectorAll('span');
                    if (spans.length === 3) {
                        spans[0].style.transform = 'rotate(0)';
                        spans[1].style.opacity = '1';
                        spans[2].style.transform = 'rotate(0)';
                    }
                    // Restore body scroll
                    document.body.style.overflow = 'auto';
                }
            }
        });

        // Close menu on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && navMenu.classList.contains('active')) {
                navMenu.classList.remove('active');
                // Reset hamburger icon
                const spans = navToggle.querySelectorAll('span');
                if (spans.length === 3) {
                    spans[0].style.transform = 'rotate(0)';
                    spans[1].style.opacity = '1';
                    spans[2].style.transform = 'rotate(0)';
                }
                // Restore body scroll
                document.body.style.overflow = 'auto';
            }
        });
    }

    // ===== MOBILE TOUCH ENHANCEMENTS =====
    // Add touch feedback to all buttons
    const buttons = document.querySelectorAll('button, .btn, .option-btn');
    buttons.forEach(button => {
        button.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
        });
        button.addEventListener('touchend', function() {
            this.style.transform = '';
        });
    });

    // ===== PREVENT DOUBLE-TAP ZOOM ON BUTTONS =====
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
            e.preventDefault();
        }
        lastTouchEnd = now;
    }, false);

    // ===== SMOOTH SCROLL FOR MOBILE =====
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const headerOffset = 80; // Account for fixed header
                const elementPosition = target.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // ===== ORIENTATION CHANGE HANDLER =====
    window.addEventListener('orientationchange', function() {
        // Close mobile menu on orientation change
        if (navMenu && navMenu.classList.contains('active')) {
            navMenu.classList.remove('active');
            const spans = navToggle.querySelectorAll('span');
            if (spans.length === 3) {
                spans[0].style.transform = 'rotate(0)';
                spans[1].style.opacity = '1';
                spans[2].style.transform = 'rotate(0)';
            }
            document.body.style.overflow = 'auto';
        }

        // Adjust viewport height for mobile browsers
        setTimeout(() => {
            window.scrollTo(0, 1);
        }, 100);
    });

    // ===== VIEWPORT HEIGHT FIX FOR MOBILE BROWSERS =====
    // Fix for mobile browsers (especially iOS) that change viewport height
    function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    setViewportHeight();
    window.addEventListener('resize', setViewportHeight);

    // Initialize progress tracking
    loadProgressData();
    loadLeaderboard('today');

    // Initialize new features
    loadNewsHeadlines();
    checkQuoteRefresh();
    checkWeeklyReset();
});

// ===== Quiz Functions =====
// NOTE: Old class-based quiz functions below are now REPLACED by:
// - quiz-system-new.js (subject-wise questions with mixed difficulty)
// - quiz-functions-complete.js (timer, loadQuestion, selectOption, navigation, results)
// These old functions are kept for reference but should NOT be used
// ====================================================================

function selectClass(classNumber) {
    quizState.selectedClass = classNumber;

    // Hide class selection, show subject selection
    document.getElementById('classSelection').classList.add('hidden');
    document.getElementById('subjectSelection').classList.remove('hidden');
}

function backToClassSelection() {
    // Reset quiz state
    resetQuizState();

    // Show class selection, hide others
    document.getElementById('classSelection').classList.remove('hidden');
    document.getElementById('subjectSelection').classList.add('hidden');
    document.getElementById('quizInterface').classList.add('hidden');
    document.getElementById('quizResults').classList.add('hidden');
}

function selectSubject(subject) {
    quizState.selectedSubject = subject;

    // Show quiz customization modal
    document.getElementById('subjectSelection').classList.add('hidden');
    document.getElementById('quizCustomization').classList.remove('hidden');
}

function selectQuestionCount(count) {
    quizState.questionCount = count;

    // Get questions for selected class and subject
    const questions = quizDatabase[quizState.selectedClass]?.[quizState.selectedSubject] || [];

    if (questions.length === 0) {
        alert('рдЗрд╕ рдХрдХреНрд╖рд╛ рдФрд░ рд╡рд┐рд╖рдп рдХреЗ рд▓рд┐рдП рдкреНрд░рд╢реНрди рдЬрд▓реНрдж рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдВрдЧреЗ!');
        return;
    }

    // Use smart question rotation (no repeats in same session)
    quizState.questions = selectSmartQuestions(
        quizState.selectedClass,
        quizState.selectedSubject,
        questions,
        count
    );
    quizState.answers = new Array(quizState.questions.length).fill(null);
    quizState.currentQuestionIndex = 0;

    // Update UI
    document.getElementById('selectedClass').textContent = quizState.selectedClass;
    document.getElementById('selectedSubject').textContent = getSubjectName(quizState.selectedSubject);
    document.getElementById('totalQuestions').textContent = quizState.questions.length;

    // Hide customization, start quiz
    document.getElementById('quizCustomization').classList.add('hidden');

    // Start quiz
    startQuiz();
}

function backToSubjectSelection() {
    stopTimer();
    document.getElementById('subjectSelection').classList.remove('hidden');
    document.getElementById('quizCustomization').classList.add('hidden');
    document.getElementById('quizInterface').classList.add('hidden');
}

function previousQuestion() {
    if (quizState.currentQuestionIndex > 0) {
        quizState.currentQuestionIndex--;
        loadQuestion();
    }
}

function goToHome() {
    if (confirm('рдХреНрдпрд╛ рдЖрдк рдХреНрд╡рд┐рдЬ рдЫреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?')) {
        resetQuizState();
        backToClassSelection();
    }
}

function startQuiz() {
    // Hide subject selection, show quiz interface
    document.getElementById('subjectSelection').classList.add('hidden');
    document.getElementById('quizInterface').classList.remove('hidden');

    // Start timer
    quizState.startTime = Date.now();
    startTimer();

    // Load first question
    loadQuestion();
}

function startTimer() {
    quizState.timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - quizState.startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('timerDisplay').textContent =
            `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }, 1000);
}

function stopTimer() {
    if (quizState.timerInterval) {
        clearInterval(quizState.timerInterval);
        quizState.timerInterval = null;
    }
}

function loadQuestion() {
    const question = quizState.questions[quizState.currentQuestionIndex];

    // Update progress
    const progress = ((quizState.currentQuestionIndex + 1) / quizState.questions.length) * 100;
    document.getElementById('progressFill').style.width = `${progress}%`;
    document.getElementById('currentQuestion').textContent = quizState.currentQuestionIndex + 1;

    // Update question text
    document.getElementById('questionText').textContent = question.question;

    // Create options
    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';

    question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-button';
        button.innerHTML = `
            <span class="option-letter">${String.fromCharCode(65 + index)}</span>
            <span class="option-text">${option}</span>
        `;
        button.onclick = () => selectOption(index);

        // Show previous selection if exists
        if (quizState.answers[quizState.currentQuestionIndex] === index) {
            button.classList.add('selected');
        }

        optionsContainer.appendChild(button);
    });

    // Hide explanation
    document.getElementById('explanationBox').classList.add('hidden');

    // Update button states
    updateButtonStates();

    // Update previous button state
    const prevBtn = document.getElementById('prevBtn');
    if (prevBtn) {
        prevBtn.disabled = quizState.currentQuestionIndex === 0;
    }
}

function selectOption(optionIndex) {
    const question = quizState.questions[quizState.currentQuestionIndex];

    // Save answer
    quizState.answers[quizState.currentQuestionIndex] = optionIndex;

    // Update UI
    const options = document.querySelectorAll('.option-button');
    options.forEach((btn, idx) => {
        btn.classList.remove('selected', 'correct', 'incorrect');
        btn.disabled = true;

        if (idx === optionIndex) {
            if (idx === question.correct) {
                btn.classList.add('correct');
            } else {
                btn.classList.add('incorrect');
            }
        }

        if (idx === question.correct) {
            btn.classList.add('correct');
        }
    });

    // Show explanation
    document.getElementById('explanationText').textContent = question.explanation;
    document.getElementById('explanationBox').classList.remove('hidden');

    // Update button states
    updateButtonStates();
}

function updateButtonStates() {
    const hasAnswer = quizState.answers[quizState.currentQuestionIndex] !== null;
    document.getElementById('nextBtn').disabled = !hasAnswer;
}

function skipQuestion() {
    quizState.answers[quizState.currentQuestionIndex] = -1; // -1 means skipped
    nextQuestion();
}

function nextQuestion() {
    if (quizState.currentQuestionIndex < quizState.questions.length - 1) {
        quizState.currentQuestionIndex++;
        loadQuestion();
    } else {
        finishQuiz();
    }
}

function finishQuiz() {
    stopTimer();

    // Calculate score
    quizState.score = {
        correct: 0,
        wrong: 0,
        skipped: 0
    };

    quizState.answers.forEach((answer, index) => {
        if (answer === -1) {
            quizState.score.skipped++;
        } else if (answer === quizState.questions[index].correct) {
            quizState.score.correct++;
        } else {
            quizState.score.wrong++;
        }
    });

    // Calculate time taken
    const timeTaken = Math.floor((Date.now() - quizState.startTime) / 1000);
    const minutes = Math.floor(timeTaken / 60);
    const seconds = timeTaken % 60;
    const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

    // Update results UI
    document.getElementById('scoreValue').textContent = quizState.score.correct;
    document.getElementById('totalScore').textContent = quizState.questions.length;

    const percentage = Math.round((quizState.score.correct / quizState.questions.length) * 100);
    document.getElementById('scorePercentage').textContent = `${percentage}%`;

    const resultsTitle = document.querySelector('#quizResults .results-title');
    if (percentage >= 70) {
        const randomIndex = Math.floor(Math.random() * high_score_messages.length);
        resultsTitle.textContent = high_score_messages[randomIndex];
    } else {
        const randomIndex = Math.floor(Math.random() * low_score_messages.length);
        resultsTitle.textContent = low_score_messages[randomIndex];
    }

    document.getElementById('correctAnswers').textContent = quizState.score.correct;
    document.getElementById('wrongAnswers').textContent = quizState.score.wrong;
    document.getElementById('skippedAnswers').textContent = quizState.score.skipped;
    document.getElementById('timeTaken').textContent = timeString;

    // Save to progress
    saveQuizResult({
        class: quizState.selectedClass,
        subject: quizState.selectedSubject,
        score: quizState.score.correct,
        total: quizState.questions.length,
        percentage: percentage,
        time: timeTaken,
        date: new Date().toISOString()
    });

    // Save attempted questions for smart rotation
    quizState.questions.forEach((question) => {
        if (question.originalIndex !== undefined) {
            saveAttemptedQuestion(
                quizState.selectedClass,
                quizState.selectedSubject,
                question.originalIndex
            );
        }
    });

    // Show results
    document.getElementById('quizInterface').classList.add('hidden');
    document.getElementById('quizResults').classList.remove('hidden');

    // Show feedback modal after 2 seconds
    setTimeout(() => {
        showFeedbackModal();
    }, 2000);
}

function retryQuiz() {
    // Restart the same quiz
    quizState.currentQuestionIndex = 0;
    quizState.answers = new Array(quizState.questions.length).fill(null);
    quizState.score = { correct: 0, wrong: 0, skipped: 0 };

    document.getElementById('quizResults').classList.add('hidden');
    document.getElementById('quizInterface').classList.remove('hidden');

    startQuiz();
}

function resetQuizState() {
    stopTimer();
    quizState = {
        selectedClass: null,
        selectedSubject: null,
        currentQuestionIndex: 0,
        questions: [],
        answers: [],
        startTime: null,
        timerInterval: null,
        score: { correct: 0, wrong: 0, skipped: 0 }
    };
}

// ===== Certificate Generation =====
function downloadCertificate() {
    // Ask for student name (mandatory)
    let studentName = null;
    while (!studentName || studentName.trim() === '') {
        studentName = prompt('ЁЯОУ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдкреВрд░рд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ:\n(Certificate рдХреЗ рд▓рд┐рдП рдирд╛рдо рдЬрд░реВрд░реА рд╣реИ)\n\nEnter your full name for certificate:');

        if (studentName === null) {
            // User clicked Cancel
            alert('тЭМ Certificate download рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ред\nCertificate download cancelled.');
            return;
        }

        if (!studentName || studentName.trim() === '') {
            alert('тЪая╕П рдирд╛рдо рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛! рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВред\nName cannot be empty! Please enter your name.');
        }
    }

    // Trim and validate name length
    studentName = studentName.trim();
    if (studentName.length < 2) {
        alert('тЪая╕П рдХреГрдкрдпрд╛ рд╡реИрдз рдирд╛рдо рд▓рд┐рдЦреЗрдВ (рдХрдо рд╕реЗ рдХрдо 2 рдЕрдХреНрд╖рд░)ред\nPlease enter a valid name (at least 2 characters).');
        return;
    }

    const percentage = Math.round((quizState.score.correct / quizState.questions.length) * 100);
    const now = new Date();
    const downloadDate = now.toLocaleDateString('hi-IN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    const downloadTime = now.toLocaleTimeString('hi-IN', {
        hour: '2-digit',
        minute: '2-digit'
    });

    // Create canvas for certificate (professional size)
    const canvas = document.createElement('canvas');
    canvas.width = 1200;
    canvas.height = 900;
    const ctx = canvas.getContext('2d');

    // Background - Elegant cream gradient
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, '#FFFBF5');
    gradient.addColorStop(0.5, '#FFF8E8');
    gradient.addColorStop(1, '#FFEFD5');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Decorative corner ornaments
    ctx.strokeStyle = '#B8860B';
    ctx.lineWidth = 3;
    // Top-left
    ctx.beginPath();
    ctx.moveTo(80, 80);
    ctx.lineTo(180, 80);
    ctx.moveTo(80, 80);
    ctx.lineTo(80, 180);
    ctx.stroke();
    // Top-right
    ctx.beginPath();
    ctx.moveTo(canvas.width - 80, 80);
    ctx.lineTo(canvas.width - 180, 80);
    ctx.moveTo(canvas.width - 80, 80);
    ctx.lineTo(canvas.width - 80, 180);
    ctx.stroke();
    // Bottom-left
    ctx.beginPath();
    ctx.moveTo(80, canvas.height - 80);
    ctx.lineTo(180, canvas.height - 80);
    ctx.moveTo(80, canvas.height - 80);
    ctx.lineTo(80, canvas.height - 180);
    ctx.stroke();
    // Bottom-right
    ctx.beginPath();
    ctx.moveTo(canvas.width - 80, canvas.height - 80);
    ctx.lineTo(canvas.width - 180, canvas.height - 80);
    ctx.moveTo(canvas.width - 80, canvas.height - 80);
    ctx.lineTo(canvas.width - 80, canvas.height - 180);
    ctx.stroke();

    // Triple border for professional look
    ctx.strokeStyle = '#DAA520';
    ctx.lineWidth = 12;
    ctx.strokeRect(50, 50, canvas.width - 100, canvas.height - 100);

    ctx.strokeStyle = '#FF6B35';
    ctx.lineWidth = 4;
    ctx.strokeRect(70, 70, canvas.width - 140, canvas.height - 140);

    ctx.strokeStyle = '#FFC107';
    ctx.lineWidth = 2;
    ctx.strokeRect(85, 85, canvas.width - 170, canvas.height - 170);

    // Gold seal/badge at top center
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.arc(canvas.width / 2, 130, 45, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#DAA520';
    ctx.lineWidth = 4;
    ctx.stroke();

    // Star in seal
    ctx.fillStyle = '#FF6B35';
    ctx.font = 'bold 45px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('тШЕ', canvas.width / 2, 145);

    // Title - Certificate of Achievement
    ctx.fillStyle = '#8B4513';
    ctx.font = 'bold 65px Georgia';
    ctx.fillText('рдкреНрд░рдорд╛рдг рдкрддреНрд░', canvas.width / 2, 220);

    // Subtitle with underline decoration
    ctx.fillStyle = '#654321';
    ctx.font = '28px Georgia';
    ctx.fillText('рд╣рдорд╛рд░ рдкрдврд╝рд╛рдИ - рдмрд┐рд╣рд╛рд░ рдХреЗ рд╣реЛрдирд╣рд╛рд░ рдЫрд╛рддреНрд░ рдХрд╛ рдЕрдбреНрдбрд╛', canvas.width / 2, 270);

    // Underline decoration
    ctx.strokeStyle = '#FFC107';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(350, 280);
    ctx.lineTo(850, 280);
    ctx.stroke();

    // Certificate body text
    ctx.fillStyle = '#2C1810';
    ctx.font = '32px Georgia';
    ctx.fillText('рдпрд╣ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐', canvas.width / 2, 350);

    // Student name with underline (prominent)
    ctx.fillStyle = '#8B0000';
    ctx.font = 'bold 52px Georgia';
    ctx.fillText(studentName.trim(), canvas.width / 2, 420);

    // Decorative underline for name
    ctx.strokeStyle = '#8B0000';
    ctx.lineWidth = 2;
    ctx.beginPath();
    const nameWidth = ctx.measureText(studentName.trim()).width;
    ctx.moveTo((canvas.width - nameWidth) / 2, 430);
    ctx.lineTo((canvas.width + nameWidth) / 2, 430);
    ctx.stroke();

    // Achievement details
    ctx.fillStyle = '#2C1810';
    ctx.font = '30px Georgia';
    ctx.fillText('рдиреЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреВрд░рд╛ рдХрд┐рдпрд╛', canvas.width / 2, 485);

    // Subject/Topic (highlighted)
    ctx.fillStyle = '#FF6B35';
    ctx.font = 'bold 40px Georgia';
    const subjectText = getSubjectName(quizState.selectedSubject);
    ctx.fillText(subjectText, canvas.width / 2, 555);

    // Score with badge background
    ctx.fillStyle = 'rgba(76, 175, 80, 0.15)';
    ctx.fillRect(400, 590, 400, 70);
    ctx.strokeStyle = '#4CAF50';
    ctx.lineWidth = 3;
    ctx.strokeRect(400, 590, 400, 70);

    ctx.fillStyle = '#2E7D32';
    ctx.font = 'bold 48px Georgia';
    ctx.fillText(`${percentage}% рдЕрдВрдХ`, canvas.width / 2, 640);

    // Signature section with line
    ctx.fillStyle = '#654321';
    ctx.font = 'italic 55px Brush Script MT, cursive';
    ctx.fillText('Pratap Kumar', 280, 760);

    // Signature line
    ctx.strokeStyle = '#000000';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(200, 770);
    ctx.lineTo(450, 770);
    ctx.stroke();

    // Title below signature
    ctx.font = '20px Georgia';
    ctx.fillStyle = '#654321';
    ctx.fillText('рдкреНрд░рдореБрдЦ рдПрд╡рдВ рд╕рдВрд╕реНрдерд╛рдкрдХ', 280, 795);

    // Date and Time section (right side)
    ctx.font = '22px Georgia';
    ctx.fillStyle = '#5D4037';
    ctx.textAlign = 'right';
    ctx.fillText(`рддрд┐рдерд┐: ${downloadDate}`, canvas.width - 200, 745);
    ctx.fillText(`рд╕рдордп: ${downloadTime}`, canvas.width - 200, 775);

    // Seal/Stamp placeholder (left side)
    ctx.strokeStyle = '#B8860B';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(920, 750, 40, 0, Math.PI * 2);
    ctx.stroke();
    ctx.fillStyle = '#DAA520';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('OFFICIAL', 920, 745);
    ctx.fillText('SEAL', 920, 765);

    // Footer motivational quote
    ctx.fillStyle = '#8B7355';
    ctx.font = 'italic 22px Georgia';
    ctx.textAlign = 'center';
    ctx.fillText('ЁЯкФ рдкрдврд╝реЗрдЧрд╛ рдмрд┐рд╣рд╛рд░, рдмрдиреЗрдЧрд╛ рд▓рд╛рд▓рдЯреЙрдк! ЁЯМЯ', canvas.width / 2, 850);

    // Download certificate
    canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `certificate-${quizState.selectedSubject}-${studentName.trim()}-${Date.now()}.png`;
        a.click();
        URL.revokeObjectURL(url);
    });
}

// ===== Progress Tracking =====
function saveQuizResult(result) {
    let progress = JSON.parse(localStorage.getItem('quizProgress') || '{"quizzes": [], "streak": 0, "lastDate": null}');

    progress.quizzes.push(result);

    // Update streak
    const today = new Date().toDateString();
    const lastDate = progress.lastDate ? new Date(progress.lastDate).toDateString() : null;

    if (lastDate === today) {
        // Same day, don't change streak
    } else if (lastDate === new Date(Date.now() - 86400000).toDateString()) {
        // Yesterday, increment streak
        progress.streak++;
    } else {
        // Streak broken, reset to 1
        progress.streak = 1;
    }
    progress.lastDate = new Date().toISOString();

    localStorage.setItem('quizProgress', JSON.stringify(progress));

    // Update leaderboard
    updateLeaderboard(result.percentage);

    // Reload progress display
    loadProgressData();
}

function loadProgressData() {
    const progress = JSON.parse(localStorage.getItem('quizProgress') || '{"quizzes": [], "streak": 0}');

    // Update streak
    document.getElementById('streakCount').textContent = progress.streak;

    // Total quizzes
    document.getElementById('totalQuizzesTaken').textContent = progress.quizzes.length;

    // Average score
    if (progress.quizzes.length > 0) {
        const avgScore = progress.quizzes.reduce((sum, q) => sum + q.percentage, 0) / progress.quizzes.length;
        document.getElementById('averageScore').textContent = Math.round(avgScore);
    }

    // Total time
    if (progress.quizzes.length > 0) {
        const totalTime = progress.quizzes.reduce((sum, q) => sum + (q.time || 0), 0);
        document.getElementById('totalTimeSpent').textContent = Math.round(totalTime / 60);
    }

    // Subject-wise progress
    const subjects = ['physics', 'chemistry', 'biology', 'general'];
    subjects.forEach(subject => {
        const subjectQuizzes = progress.quizzes.filter(q => q.subject === subject);
        if (subjectQuizzes.length > 0) {
            const avgScore = subjectQuizzes.reduce((sum, q) => sum + q.percentage, 0) / subjectQuizzes.length;
            const roundedScore = Math.round(avgScore);
            document.getElementById(`${subject}Progress`).textContent = `${roundedScore}%`;
            const fillElement = document.querySelector(`.progress-bar-fill.${subject}`);
            if (fillElement) {
                fillElement.style.width = `${roundedScore}%`;
            }
        }
    });
}

// ===== Leaderboard =====
function updateLeaderboard(score) {
    let leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');

    // Generate anonymous user ID if doesn't exist
    let userId = localStorage.getItem('anonymousUserId');
    if (!userId) {
        userId = 'user_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('anonymousUserId', userId);
    }

    const entry = {
        userId: userId, // Anonymous ID
        score: score,
        date: new Date().toISOString()
    };

    leaderboard.push(entry);
    leaderboard.sort((a, b) => b.score - a.score);
    leaderboard = leaderboard.slice(0, 100); // Keep top 100

    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
    loadLeaderboard('today');
}

function switchLeaderboardTab(period) {
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');

    loadLeaderboard(period);
}

function loadLeaderboard(period) {
    let leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
    const currentUserId = localStorage.getItem('anonymousUserId');

    // Filter by period
    const now = new Date();
    if (period === 'today') {
        leaderboard = leaderboard.filter(entry => {
            const entryDate = new Date(entry.date);
            return entryDate.toDateString() === now.toDateString();
        });
    } else if (period === 'week') {
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        leaderboard = leaderboard.filter(entry => new Date(entry.date) >= weekAgo);
    }

    // Display leaderboard
    const listElement = document.getElementById('leaderboardList');
    if (leaderboard.length === 0) {
        listElement.innerHTML = '<p style="text-align: center; padding: 2rem; color: #8D6E63;">рдЕрднреА рддрдХ рдХреЛрдИ рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ рд╣реИред рдкрд╣рд▓реЗ рдмрдиреЗрдВ!</p>';
        return;
    }

    // Anonymous leaderboard - show only rank and score
    listElement.innerHTML = leaderboard.slice(0, 10).map((entry, index) => {
        const isCurrentUser = entry.userId === currentUserId;
        const highlightClass = isCurrentUser ? ' style="background: #FFF8E1; border-left: 4px solid #FF6B35;"' : '';

        return `
            <div class="leaderboard-item"${highlightClass}>
                <div class="leaderboard-rank">${index + 1}</div>
                <div class="leaderboard-name">${isCurrentUser ? 'рдЖрдк ЁЯМЯ' : 'рдЫрд╛рддреНрд░'}</div>
                <div class="leaderboard-score">${entry.score}%</div>
            </div>
        `;
    }).join('');

    // Show user's overall rank if not in top 10
    if (currentUserId) {
        const userRank = leaderboard.findIndex(entry => entry.userId === currentUserId) + 1;
        if (userRank > 10 && userRank <= leaderboard.length) {
            listElement.innerHTML += `
                <div class="leaderboard-item" style="background: #FFF8E1; border-left: 4px solid #FF6B35; margin-top: 1rem;">
                    <div class="leaderboard-rank">${userRank}</div>
                    <div class="leaderboard-name">рдЖрдк ЁЯМЯ</div>
                    <div class="leaderboard-score">${leaderboard[userRank - 1].score}%</div>
                </div>
            `;
        }
    }
}

// ===== Study Materials =====
function openStudyMaterial(classRange) {
    alert(`рдХрдХреНрд╖рд╛ ${classRange} рдХреЗ рд▓рд┐рдП рдЕрдзреНрдпрдпрди рд╕рд╛рдордЧреНрд░реА рдЬрд▓реНрдж рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧреА!`);
    // In future, this would open a modal or new page with study materials
}

// ===== Helper Functions =====
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

function getSubjectName(subject) {
    const names = {
        physics: 'рднреМрддрд┐рдХ рд╡рд┐рдЬреНрдЮрд╛рди',
        chemistry: 'рд░рд╕рд╛рдпрди рд╡рд┐рдЬреНрдЮрд╛рди',
        biology: 'рдЬреАрд╡ рд╡рд┐рдЬреНрдЮрд╛рди',
        general: 'рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдЬреНрдЮрд╛рди'
    };
    return names[subject] || subject;
}

// ===== Dark Mode Toggle =====
function toggleDarkMode() {
    const body = document.body;
    const darkModeIcon = document.getElementById('darkModeIcon');
    const darkModeText = document.getElementById('darkModeText');

    body.classList.toggle('dark-mode');

    // Update icon and text
    if (body.classList.contains('dark-mode')) {
        darkModeIcon.textContent = 'тШАя╕П';
        darkModeText.textContent = 'Light Mode';
        localStorage.setItem('darkMode', 'enabled');
    } else {
        darkModeIcon.textContent = 'ЁЯМЩ';
        darkModeText.textContent = 'Dark Mode';
        localStorage.setItem('darkMode', 'disabled');
    }
}

// Load dark mode preference on page load
document.addEventListener('DOMContentLoaded', function() {
    const darkModePreference = localStorage.getItem('darkMode');
    const darkModeIcon = document.getElementById('darkModeIcon');
    const darkModeText = document.getElementById('darkModeText');

    if (darkModePreference === 'enabled') {
        document.body.classList.add('dark-mode');
        darkModeIcon.textContent = 'тШАя╕П';
        darkModeText.textContent = 'Light Mode';
    }
});
